<?phpnamespace Applications\Frontend\Modules\Proto;class ProtoController extends \Library\BackController{	public function executeShow(\Library\HTTPRequest $request)	{		// On ajoute une définition pour le titre.		$titre = array("" => "AssurMF - form", "fr" => "AssurMF - form","en" => "AssurMF - form","es" => "AssurMF - form");		$this->page->addVar('title', $titre[$this->app->user()->getAttribute('lang')]);		$manager = $this->managers->getManagerOf('MutuellesIndividuelles');		$regimesManager = $this->managers->getManagerOf('Regimes');		if($request->method() == 'GET' ) {/*			$MI = new \Library\Entities\MutuelleIndividuelle();*/				$d = new \DateTime('NOW');				$d = $d->format("d/m/Y");				$MI = new \Library\Entities\MutuelleIndividuelle(array(				'dateNaissance' => $d,				'regime' => new \Library\Entities\Regime()			));			$regime = new \Library\Entities\Regime();		} elseif($request->method() == 'POST') {			$regime = new \Library\Entities\Regime(array(				'titre' => $request->postData('regime')			));			$d = \DateTime::createFromFormat("Y-m-d", $request->postData('dateNaissance'));			if($d) {				$MI = new \Library\Entities\MutuelleIndividuelle(array(					'dateNaissance' => $request->postData('dateNaissance'),					'regime' => $request->postData('regime')			));			} else  {				$d = new \DateTime('NOW');				$d = $d->format("Y-m-d");				$MI = new \Library\Entities\MutuelleIndividuelle(array(				'dateNaissance' => $d,				'regime' => $request->postData('regime')			));		}	}		$formBuilder = new \Library\FormBuilder\MutuelleIndividuelleFormBuilder($MI);// n'accepte pas $regime, va comprendre.		$subFormBuilder = new \Library\FormBuilder\RegimeFormBuilder($MI);		$subFormBuilder->setData($regimesManager->getTitresRegimes());		$subFormBuilder->build();		$formBuilder->build();		$form = $formBuilder->form();		$subForm = $subFormBuilder->form();		if ($form->isValid()) {			if ($subForm->isValid()) {				$manager = $this->managers->getManagerOf('MutuellesIndividuelles');// enregistrer la MI dans la BDD, e.g. en prenant exemple sur le controller de livredor du site pro. Utiliser l'id de régime au lieu d'un texte.				$this->app->user()->setFlash('<span class="text-success">Formulaire valide');			} else {				$this->app->user()->setFlash('<span class="text-danger">Échec de formulaire');			}		} else {				$this->app->user()->setFlash('<span class="text-danger">Échec de formulaire');		}		if ($this->app->user()->hasFlash()) {			$this->page->addVar('flash', $this->app->user()->getFlash());		}		$this->page->addVar('subForm', $subForm->createView()); 		$this->page->addVar('form', $form->createView()); // On passe le formulaire généré à la vue.	}}